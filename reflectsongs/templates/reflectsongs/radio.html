{% extends 'reflectsongs/base.html' %}

{% block head %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/video.js/7.11.5/video.min.js"
  integrity="sha512-HwmeTRPtX4IwZhPJINKNQQ/szpRFWGFk9Cv5JTLTEENcM6Kq6VD/5GKRSZJ37CHzYaS8dK1CfsNk9MXLDm/dLQ==" crossorigin="anonymous">
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-youtube/2.6.1/Youtube.min.js" integrity="sha512-mF+XuiEvJq707N/B9Fm/fI2wgMcWuFLsoztIp0UzEKgHCZgczbYpO2+Vq2TEi0LmE4crVj2r8AYru7X5QjVotw==" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/videojs-playlist@4.3.1/dist/videojs-playlist.min.js" integrity="sha256-9SaTQgEH5mVWnqixYTM3cjyN8zbUTx/UmldDVFYLU70=" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/video.js/7.11.5/video-js.min.css" integrity="sha512-+krGgE9EwStC6GBtdEVdolP3uGa4ZiPGLxq6S4lY4R2eLK0/+1EJND+7llLQ+TBpt4/6vu4RWP6g8r60/JJNHQ==" crossorigin="anonymous" />

{% endblock %}

{% block title %}Radio{% endblock %}
{% block content %}

<div class="row">
  <div class="col-sm-12 col-md-6">

    <h1>
      Reflect Radio
    </h1>

    <video id="playlist" class="video-js vjs-fluid" controls
            data-setup='{}'>

  </div>
  <div class="col-sm-12 col-md-6">
    <p>
      A random playlist of the most popular songs sung over the past 12 months.
    </p>
    <ul class="list-group mt-3">
      {% for song in songs %}
      <li class="list-group-item song">
          <b>{{ song }}</b>
          {% if song.authors %}<small>- {{ song.authors }}</small>{% endif %}
          <br />
          <a class="btn btn-primary play" href="#">play</a>
          <a class="btn btn-primary details" href="{% url 'song-view' song.slug %}" target="_blank">details</a>
        </li>
        {% endfor %}
    </ul>
  </div>
</div>

<script>
var player = videojs('playlist');
var songs = [];
{% for song in songs %}
songs.push({
  sources: [{
    src: '{{ song.youtube_url.strip }}',
    type: 'video/youtube'
  }]
});
{% endfor %}

player.playlist(songs);

// Play through the playlist automatically.
player.playlist.autoadvance(0);

$('li.song a.play').each(function(ind, item) {
  $(item).on('click', function() {
    player.playlist.currentItem(ind);
    player.play();
    return false;
  });
});

</script>


{% endblock %}
